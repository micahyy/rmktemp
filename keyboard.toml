[keyboard]
name = "CZMAOWL17"
product_name = "Wireless17"
vendor_id = 0x4c4b
product_id = 0x4643
manufacturer = "CaiZiMao"
chip = "nrf52840"

[features]
vial = { enabled = true }

[matrix]
row_pins = ["P0_10", "P0_30", "P0_31", "P0_29", "P0_02"]
col_pins = ["P0_05", "P0_13", "P0_24", "P0_09"]

[layout]
rows = 5
cols = 4
layers = 10
matrix_map = """
(0,0) (0,1) (0,2) (0,3)
(1,0) (1,1) (1,2) (1,3)
(2,0) (2,1) (2,2)
(3,0) (3,1) (3,2) (3,3)
    (4,0)    (4,2)
"""

[[layer]]
name = "base_layer"
keys = """
LT(1,NumLock)    KpSlash    KpAsterisk    KpMinus
Kp7        Kp8        Kp9           KpPlus
Kp4        Kp5        Kp6
Kp1        Kp2        Kp3           KPENTER
    Kp0         KpDot
"""
encoders = [["AudioVolUp", "AudioVolDown"]]

[[layer]]
name = "second_layer"
keys = """
No  No       WM(W,LShift)         No
DF(0)  LT(1, Space) LM(0, LShift | RGui) 
OSL(0) OSM(LAlt)    TH(Kp1, Kp2)        SHIFTED(Kp2)
    @my_copy        @my_paste
"""
encoders = [["BrightnessUp", "BrightnessDown"]]

[[layer]]
name = "3rd_layer"
keys = """
No  No       No         No
No  No       No         No
No  No       No         
No  No       No         No
No        No       
"""

[aliases]
my_copy = "WM(C, LCtrl)"
my_paste = "WM(V, LCtrl)"

[light]
capslock.pin = "P1_13"
capslock.low_active = false
scrolllock.pin = "P0_28"
scrolllock.low_active = false
# 这是我们要用来显示蓝牙状态的 LED
numslock.pin = "P1_11"
numslock.low_active = false 

# ==================== 关键修改：移除 indicators 字段 ====================
[storage]
clear_storage = true

# ==================== 修正的蓝牙配置 ====================
[ble]
enabled = true
battery_adc_pin = "P0_04"
adc_divider_measured = 250
adc_divider_total = 500
charge_state = "P1_11"

# 可选：设置蓝牙发射功率（0-8，默认4）
default_tx_power = 4

# 使用 2M PHY 提高传输速度
ble_use_2m_phy = true



[behavior.combo]
timeout = "150ms"
combos = [
  { actions = ["J", "K"], output = "L" },
  { actions = ["F", "D"], output = "TO(1)", layer = 0 },
  { actions = ["A", "S", "D"], output = "X" },
]

[behavior.fork]
forks = [
  { trigger = "Dot", negative_output = "Dot", positive_output = "WM(Semicolon, LShift)", match_any = "LShift|RShift" },
  { trigger = "Comma", negative_output = "Comma", positive_output = "Semicolon", match_any = "LShift|RShift", match_none = "LAlt|RAlt" },
  { trigger = "LeftBracket", negative_output = "WM(LeftBracket, LShift)", positive_output = "LeftBracket", match_any = "LShift|RShift" },
  { trigger = "X", negative_output = "WM(X, LShift)", positive_output = "X", match_any = "LShift|RShift" },
  { trigger = "F24", negative_output = "A", positive_output = "Macro1", match_any = "LShift|LCtrl" },
  { trigger = "Y", negative_output = "Y", positive_output = "Z", match_any = "MouseBtn1", bindable = false },
  { trigger = "Z", negative_output = "Z", positive_output = "Y", match_any = "MouseBtn1", bindable = false },
  { trigger = "LT(2,Backspace)", negative_output = "LT(2,Backspace)", positive_output = "LT(2,Delete)", match_any = "LShift|RShift" },
  { trigger = "MediaPlayPause", negative_output = "MediaPlayPause", positive_output = "MediaNextTrack", match_any = "LCtrl|RCtrl", bindable = true },
  { trigger = "MediaNextTrack", negative_output = "MediaNextTrack", positive_output = "BrightnessUp", match_any = "LAlt|RAlt", bindable = true },
  { trigger = "BrightnessUp", negative_output = "BrightnessUp", positive_output = "BrightnessDown", match_any = "LShift|RShift", bindable = false },
  { trigger = "MediaNextTrack", negative_output = "MediaNextTrack", positive_output = "MediaPrevTrack", match_any = "LShift|RShift", match_none = "LAlt|RAlt", bindable = false },
  { trigger = "MediaPlayPause", negative_output = "MediaPlayPause", positive_output = "AudioVolUp", match_any = "LAlt|RAlt", match_none = "LCtrl|RCtrl", bindable = true },
  { trigger = "AudioVolUp", negative_output = "AudioVolUp", positive_output = "AudioVolDown", match_any = "LShift|RShift", match_none = "LCtrl|RCtrl", bindable = false },
]

[rmk]
combo_max_num = 128
fork_max_num = 16

[chip.nrf52840]
dcdc_reg0 = true
dcdc_reg1 = true
dcdc_reg0_voltage = "3V3"
